{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>terzonemap</title>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="{% static 'leaflet.css'%}">
    <script src="{% static 'leaflet-src.js.map'%}"></script>
    <script src="{% static 'jquery-1.7.2.js'%}"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		#map {
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
<nav class="mb-2 px-3 navbar navbar-light bg-light">
  <a class="navbar-brand" href="{% url 'index' %}">TerzoneGIS</a>

  <div>
    {% if user.is_authenticated %}
      <a href="{% url 'site_auth:about-me' %}">{{ user.username }}</a>
      <a href="{% url 'site_auth:logout' %}">Logout</a>
    {% else %}
      <a
        class="btn btn-outline-primary"
        href="{% url 'site_auth:login' %}">
        Login
      </a>
    {% endif %}
  </div>
</nav>


<label>FILTER (input index):</label>
<input type='input' type='text' id='cql'>
<input type='button' id='btn' value='SEARCH'>
<div id='map'></div>
<script>
    var baseurl ='http://127.0.0.1:8000/';
	var map = L.map('map').setView([56.8416,60.5956],10);
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
	}).addTo(map);
	wmsOptions = {
		layers: 'terzone_terzoneexist',
		format: 'image/png',
		transparent: true,
		// CQL_FILTER : "id='terzone_terzoneexist.1000010071732692'"
	}
	var wmsLayer = L.tileLayer.wms('http://127.0.0.1:8000/terzone/getwmts?', wmsOptions).addTo(map);
	$("#btn").click(function() {
		var cql = encodeURIComponent($("#cql").val());
				var feature_url = baseurl +'terzone/feature?request=GetFeature&version=1.1.0&typeName=gis:terzone_terzoneexist&outputFormat=application/json&CQL_FILTER=' +cql;
        $.ajax(
            {
                url:feature_url,
                type:'GET',
                dataType:'json',
                headers:{'Content-Type':'application/json;charset=utf8'},
                success:function(data){
                	console.log(data);
                	L.geoJSON(data, {
					    style: {'color': "#000000",
							    	'fillColor': "#ffffff",
					    			'opacity': 0.7,
					    			'weight': 5,
					    }

				}).addTo(map);
                },
                error:function(data){
                    console.log('faile');
                    console.log(data);
                }
            }
        );
	})
</script>
</body>
</html>
